<h1>
  {% if form.instance.pk %}Edit Character{% else %}Create Character{% endif %}
</h1>

<form method="POST" action="">
  {% csrf_token %}
  
  <button type="submit">
    {% if form.instance.pk %}Save{% else %}Create{% endif %}
  </button>

  {{ form.as_p }}

  <button type="submit">
    {% if form.instance.pk %}Save{% else %}Create{% endif %}
  </button>
</form>

<p><a href="{% url 'characters' %}">Back to list</a></p>

<script>
const classSelect = document.getElementById("id_character_class");
const subclassSelect = document.getElementById("id_subclass");

// Obsługa Podklas
if (classSelect) {
    classSelect.addEventListener("change", function () {
        const classId = this.value;

        if (subclassSelect) {
            subclassSelect.innerHTML = "<option value=''>---------</option>";

            if (!classId) return;

            fetch(`/ajax/subclasses/?class_id=${classId}`)
                .then(res => res.json())
                .then(data => {
                    data.forEach(subclass => {
                        const opt = document.createElement("option");
                        opt.value = subclass.id;
                        opt.textContent = subclass.name;
                        subclassSelect.appendChild(opt);
                    });
                });
        }
    });
}
</script>

<script>
// Obsługa Skilli
document.addEventListener('DOMContentLoaded', function() {
    const classSelect = document.getElementById('id_character_class');
    const skillsContainer = document.querySelector('#id_skills');

    function updateSkills(classId) {
        fetch(`/skills-for-class/?class_id=${classId}`)
            .then(response => response.json())
            .then(data => {
                // Clear existing checkboxes
                skillsContainer.innerHTML = '';

                data.forEach(skill => {
                    const label = document.createElement('label');
                    label.style.display = 'block';
                    const input = document.createElement('input');
                    input.type = 'checkbox';
                    input.name = 'skills';
                    input.value = skill.id;
                    label.appendChild(input);
                    label.appendChild(document.createTextNode(' ' + skill.name));
                    skillsContainer.appendChild(label);
                });
            });
    }

    if (classSelect) {
        classSelect.addEventListener('change', function() {
            const selectedClass = this.value;
            if (selectedClass) {
                updateSkills(selectedClass);
            }
        });

        // Trigger update on page load if class already selected
        if (classSelect.value) {
            updateSkills(classSelect.value);
        }
    }
});
</script>